<!DOCTYPE html>

<html>
<head>
  <title>router.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>router.js</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="calamar.html">
                    calamar.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="facebook.html">
                    facebook.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="facebookGraphHelpers.html">
                    facebookGraphHelpers.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="facebookWebhookSetup.html">
                    facebookWebhookSetup.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="index.html">
                    index.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="luis.html">
                    luis.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="router.html">
                    router.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="wit.html">
                    wit.js
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <h2 id="createrouter">createRouter</h2>

        
      
        
        <p>A higher-order function that creates router function that maps inputs
to outputs based on a set of routes.</p>
<h3 id="syntax">Syntax</h3>
<pre><code class="lang-javascript">createRouter(routes)
</code></pre>
<h4 id="parameters">Parameters</h4>
<p><strong>routes</strong> - <em>Array</em> - A list of routes. A route is a two-elements array
representing a input/output mapping (see below).</p>
<p><strong>route</strong> - <em>Array</em> - A pair of elements that represents a mapping
between a compare function (or <em>string</em> or <em>RegExp</em>) and an output function
(or a value).</p>
<p><code>[compare, output]</code></p>
<h4 id="return">Return</h4>
<p>Returns a <em>function</em>. The returned function expects the first parameter
to be the input object or string that is used for routing to the correct
callback. All the parameters (the frist one, input, and any others) are
forwarded to the callback. This can be useful for passing context to the
callbacks or any extra data.</p>
<h3 id="examples">Examples</h3>
<h4 id="-string-value-routes">[string, value] routes</h4>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> routes = [
    [<span class="hljs-string">'yes'</span>, <span class="hljs-string">'no'</span>],
    [<span class="hljs-string">'stop'</span>, <span class="hljs-string">'go go go'</span>],
    [<span class="hljs-string">'goodbye'</span>, <span class="hljs-string">'hello'</span>],
    [<span class="hljs-string">'high'</span>, <span class="hljs-string">'low'</span>],
    [<span class="hljs-string">'why'</span>, <span class="hljs-string">'I don’t know'</span>]
];
<span class="hljs-keyword">const</span> router = createRouter(routes);

<span class="hljs-built_in">console</span>.log(router(<span class="hljs-string">'high'</span>)); <span class="hljs-comment">// 'low'</span>
<span class="hljs-built_in">console</span>.log(router(<span class="hljs-string">'cha cha cha'</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h4 id="-regexp-value-routes">[regExp, value] routes</h4>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> routes = [
    [<span class="hljs-regexp">/yes/i</span>, <span class="hljs-string">'no'</span>],
    [<span class="hljs-regexp">/stop/i</span>, <span class="hljs-string">'go go go'</span>],
    [<span class="hljs-regexp">/goodbye/i</span>, <span class="hljs-string">'hello'</span>],
    [<span class="hljs-regexp">/high/i</span>, <span class="hljs-string">'low'</span>],
    [<span class="hljs-regexp">/why/i</span>, <span class="hljs-string">'I don’t know'</span>]
];
<span class="hljs-keyword">const</span> router = createRouter(routes);

<span class="hljs-built_in">console</span>.log(router(<span class="hljs-string">'I say HIGH, you say?'</span>)); <span class="hljs-comment">// 'low'</span>
<span class="hljs-built_in">console</span>.log(router(<span class="hljs-string">'cha cha cha'</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h4 id="-string-function-routes">[string, function] routes</h4>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> callbacks = {
    yes() { <span class="hljs-keyword">return</span> <span class="hljs-string">'no'</span>; },
    halt() { <span class="hljs-keyword">return</span> <span class="hljs-string">'go go go'</span>; },
    goodbye() { <span class="hljs-keyword">return</span> <span class="hljs-string">'hello'</span>; },
    high() { <span class="hljs-keyword">return</span> <span class="hljs-string">'low'</span>; },
    why() { <span class="hljs-keyword">return</span> <span class="hljs-string">'I don’t know'</span>; }
};
<span class="hljs-keyword">const</span> routes = [
    [<span class="hljs-string">'yes'</span>, callbacks.yes],
    [<span class="hljs-string">'stop'</span>, callbacks.halt],
    [<span class="hljs-string">'goodbye'</span>, callbacks.goodbye],
    [<span class="hljs-string">'high'</span>, callbacks.high],
    [<span class="hljs-string">'why'</span>, callbacks.why]
];
<span class="hljs-keyword">const</span> router = createRouter(routes);

<span class="hljs-built_in">console</span>.log(router(<span class="hljs-string">'high'</span>)); <span class="hljs-comment">// 'low'</span>
<span class="hljs-built_in">console</span>.log(router(<span class="hljs-string">'cha cha cha'</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h4 id="-function-function-routes">[function, function] routes</h4>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { createRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'calamars'</span>;

<span class="hljs-keyword">const</span> input1 = {
    query: <span class="hljs-string">'Stop!'</span>,
    intentName: <span class="hljs-string">'stop'</span>,
    score: <span class="hljs-number">0.9629247</span>
};
<span class="hljs-keyword">const</span> input2 = {
    query: <span class="hljs-string">'Foobar'</span>,
    intentName: <span class="hljs-string">'None'</span>,
    score: <span class="hljs-number">0.546681643</span>
};
<span class="hljs-keyword">const</span> extraParam = <span class="hljs-string">'hello.'</span>;

<span class="hljs-keyword">const</span> routes = [[
    obj =&gt; obj.intentName === <span class="hljs-string">'stop'</span>,
    obj =&gt; <span class="hljs-string">`You say <span class="hljs-subst">${obj.query}</span>, I say go go go, oh no.`</span>
], [
    obj =&gt; obj.intentName === <span class="hljs-string">'None'</span>,
    (obj, extra) =&gt; <span class="hljs-string">`I dont know why you say <span class="hljs-subst">${obj.query}</span>, I say <span class="hljs-subst">${extra}</span>`</span>
]];

<span class="hljs-keyword">const</span> router = createRouter(routes);

<span class="hljs-built_in">console</span>.log(router(input1)); <span class="hljs-comment">// You say Stop!, I say go go go, oh no.</span>
<span class="hljs-built_in">console</span>.log(router(input2, extraParam)); <span class="hljs-comment">// I dont know why you say Foobar, I say hello.</span>
</code></pre>
<p>See <a href="https://github.com/fczuardi/calamars/blob/master/test/router.js">test/router.js</a> for more examples.</p>
<hr>

        
      
        
        <h3 id="source">Source</h3>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> createRouter = routes =&gt; (input, ...other) =&gt; {
    <span class="hljs-keyword">if</span> (!routes) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }</pre></div>
        
      
        
        <p>The <code>compare</code> side of a <code>[compare(), callback()]</code> route
is normally a function. But it can also be a string or a regular
expression, and on those cases it will be treated as a shortcut
for exact match or <code>RegExp.test</code> respectively.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">const</span> matchingRoutes = routes.filter(route =&gt; {
        <span class="hljs-keyword">const</span> cmp = route[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> cmp === <span class="hljs-string">'function'</span>) {
            <span class="hljs-keyword">return</span> cmp(input, ...other);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> cmp === <span class="hljs-string">'string'</span>) {
            <span class="hljs-keyword">return</span> cmp === input;
        }
        <span class="hljs-keyword">if</span> (cmp <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
            <span class="hljs-keyword">return</span> cmp.test(input);
        }
        <span class="hljs-keyword">return</span> [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>];
    });</pre></div>
        
      
        
        <p>if no route is matched, return null</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!matchingRoutes.length) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }</pre></div>
        
      
        
        <p>first matched route</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">const</span> firstMatch = matchingRoutes[<span class="hljs-number">0</span>];</pre></div>
        
      
        
        <p>if matched route is not a properly formatted route</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!firstMatch.length) { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }

    <span class="hljs-keyword">const</span> [compare, callback] = firstMatch;</pre></div>
        
      
        
        <p>When the callback is a function, return the call
to that callback passing the input as argument and any other arguments
used on the router() call</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span> &amp;&amp; !(compare <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>)) {
        <span class="hljs-keyword">return</span> callback(input, ...other);
    }</pre></div>
        
      
        
        <p>Alternative usage. When the <code>compare</code> part of a route is a regular
expression, returns the call to the callback passing the matches as
first argument and any other extra arguments after that.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (compare <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span> &amp;&amp; <span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">const</span> matches = compare.exec(input);
        <span class="hljs-keyword">return</span> callback(matches, ...other);
    }</pre></div>
        
      
        
        <p>Alternative usage. When the <code>callback</code> part of a
<code>[compare(), callback()]</code> route is a value instead
of a function, return it</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">return</span> callback;
};</pre></div>
        
      
        
        <hr>

        
      
        
        
        
          <div class='highlight'><pre>
<span class="hljs-keyword">export</span> {
    createRouter
};</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>

<!DOCTYPE html>

<html>
<head>
  <title>WitDriver</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="witdriver">WitDriver</h1>

          
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="calamar.html">
                    calamar.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="contextSet.html">
                    contextSet.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="dbLocalStorage.html">
                    dbLocalStorage.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="facebook.html">
                    facebook.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="facebookGraphHelpers.html">
                    facebookGraphHelpers.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="facebookWebhookSetup.html">
                    facebookWebhookSetup.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="index.html">
                    index.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="luis.html">
                    luis.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="router.html">
                    router.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="s3ContextSet.html">
                    s3ContextSet.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="s3Storage.html">
                    s3Storage.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="wit.html">
                    wit.js
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <p>A wrapper class for the Wit Webservice (<a href="https://wit.ai/docs/http/20160330">https://wit.ai/docs/http/20160330</a> ).</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'request-promise'</span>;

<span class="hljs-keyword">const</span> baseURL = <span class="hljs-string">'https://api.wit.ai'</span>;
<span class="hljs-keyword">const</span> apiVersion = <span class="hljs-string">'20160330'</span>;
<span class="hljs-keyword">const</span> intentEndpoint = <span class="hljs-string">'/message'</span>;
<span class="hljs-keyword">const</span> messageEndpoint = <span class="hljs-string">'/messages/'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WitDriver</span> </span>{</pre></div>
        
      
        
        <h2 id="constructor">Constructor</h2>
<h3 id="parameters">Parameters</h3>
<ul>
<li><strong>options</strong> - <em>Object</em> - Configuration object.<ul>
<li><strong>id</strong> - <em>string</em> - A wit app ID.</li>
<li><strong>serverToken</strong> - <em>string</em> - The Server Access Token for that wit app.</li>
</ul>
</li>
</ul>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">constructor</span>(options) {
        <span class="hljs-keyword">const</span> {
            id,
            serverToken
        } = options;

        <span class="hljs-keyword">if</span> (!id || !serverToken) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
                <span class="hljs-string">'WitDriver could not be instantiated. Missing required options.'</span>
            );
        }

        <span class="hljs-keyword">this</span>.queryURL = <span class="hljs-string">`<span class="hljs-subst">${baseURL}</span><span class="hljs-subst">${intentEndpoint}</span>?v=<span class="hljs-subst">${apiVersion}</span>`</span>;
        <span class="hljs-keyword">this</span>.messageInfoURL = messageId =&gt;
            <span class="hljs-string">`<span class="hljs-subst">${baseURL}</span><span class="hljs-subst">${messageEndpoint}</span><span class="hljs-subst">${messageId}</span>?v=<span class="hljs-subst">${apiVersion}</span>`</span>;
        <span class="hljs-keyword">this</span>.requestHeaders = {
            Authorization: <span class="hljs-string">`Bearer <span class="hljs-subst">${serverToken}</span>`</span>,
            Accept: <span class="hljs-string">`application/vnd.wit.<span class="hljs-subst">${apiVersion}</span>+json`</span>
        };
    }</pre></div>
        
      
        
        <h3 id="methods">Methods</h3>
<h4 id="query">query</h4>
<h5 id="parameters">Parameters</h5>
<ul>
<li><strong>text</strong> - <em>string</em> - a text query to send to the Wit webservice.</li>
<li><strong>verbose</strong> - <em>boolean</em> - if the response should include extra info,
like start/end of the entities</li>
<li><strong>n</strong> - <em>number</em> - The number of n-best outcomes you want to get back. default is 1</li>
</ul>
<h5 id="return">return</h5>
<p>Returns a Promise that returns the parsed object from the webservice.
See <a href="https://wit.ai/docs/http/20160330#get-intent-via-text-link">https://wit.ai/docs/http/20160330#get-intent-via-text-link</a></p>

        
          <div class='highlight'><pre>    query(text = <span class="hljs-string">''</span>, verbose = <span class="hljs-literal">false</span>, n = <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${this.queryURL}</span>&amp;q=<span class="hljs-subst">${encodeURIComponent(text)}</span>&amp;verbose=<span class="hljs-subst">${verbose}</span>&amp;n=<span class="hljs-subst">${n}</span>`</span>;
        <span class="hljs-keyword">return</span> request({
            url,
            headers: <span class="hljs-keyword">this</span>.requestHeaders
        }).then(body =&gt; <span class="hljs-built_in">JSON</span>.parse(body));
    }</pre></div>
        
      
        
        <h4 id="getmessage">getMessage</h4>
<h5 id="parameters">Parameters</h5>
<ul>
<li><strong>id</strong> - <em>string</em> - the id of the message you want to inspect on wit</li>
</ul>
<h5 id="return">return</h5>
<p>Returns a Promise that returns the parsed object from the webservice.
See: <a href="https://wit.ai/docs/http/20160330#get-message-link">https://wit.ai/docs/http/20160330#get-message-link</a></p>

        
          <div class='highlight'><pre>    getMessage(id) {
        <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">this</span>.messageInfoURL(id);
        <span class="hljs-keyword">return</span> request({
            url,
            headers: <span class="hljs-keyword">this</span>.requestHeaders
        }).then(body =&gt; <span class="hljs-built_in">JSON</span>.parse(body));
    }
}</pre></div>
        
      
        
        <h2 id="examples">Examples</h2>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> options = {
    id: <span class="hljs-string">'YOUR_WIT_ID'</span>,
    serverToken: <span class="hljs-string">'YOUR_WIT_TOKEN'</span>
};
<span class="hljs-keyword">const</span> wit = <span class="hljs-keyword">new</span> WitDriver(options);
luis.query(<span class="hljs-string">'Hi'</span>)
    .then(result =&gt; {
        <span class="hljs-keyword">const</span> {
            _text,
            outcomes
        } = result;
        <span class="hljs-built_in">console</span>.log(_text); <span class="hljs-comment">// 'Hi'</span>
        <span class="hljs-built_in">console</span>.log(outcomes.length); <span class="hljs-comment">// 1</span>
    });
</code></pre>
<p>See <a href="https://github.com/fczuardi/calamars/blob/master/test/wit.js">test/wit.js</a> for more examples.</p>
<h2 id="static-methods">Static Methods</h2>
<h4 id="getentity">getEntity</h4>
<p>Gets the first entityName found.</p>
<h5 id="parameters">Parameters</h5>
<ul>
<li><strong>outcomes</strong> - <em>object</em> - an outcomes object returned by wit.ai API call</li>
<li><strong>entityName</strong> - <em>string</em> - the name of the entity you look for</li>
</ul>
<h5 id="return">return</h5>
<p>Returns an entity object or null</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> getEntity = (outcomes, entityName) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> outcomes.entities[entityName][<span class="hljs-number">0</span>];
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
};

WitDriver.getEntity = getEntity;</pre></div>
        
      
        
        <h4 id="getentities">getEntities</h4>
<p>Gets all entities of name entityName.</p>
<h5 id="parameters">Parameters</h5>
<ul>
<li><strong>outcomes</strong> - <em>object</em> - an outcomes object returned by wit.ai API call</li>
<li><strong>entityName</strong> - <em>string</em> - the name of the entity you look for</li>
</ul>
<h5 id="return">return</h5>
<p>Returns an array of entities or null</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">const</span> getEntities = (outcomes, entityName) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> outcomes.entities[entityName];
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
};

WitDriver.getEntities = getEntities;</pre></div>
        
      
        
        <h4 id="getentityvalue">getEntityValue</h4>
<h5 id="parameters">Parameters</h5>
<ul>
<li><strong>outcomes</strong> - <em>object</em> - an outcomes object returned by wit.ai API call</li>
<li><strong>entityName</strong> - <em>string</em> - the name of the entity you look for</li>
</ul>
<h5 id="return">return</h5>
<p>Returns the value of the entity you look for or null</p>

        
          <div class='highlight'><pre>WitDriver.getEntityValue = (outcomes, entityName) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> getEntity(outcomes, entityName).value;
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
};</pre></div>
        
      
        
        <h4 id="getentitymeta">getEntityMeta</h4>
<h5 id="parameters">Parameters</h5>
<ul>
<li><strong>entity</strong> - <em>object</em> - an entity object</li>
</ul>
<h5 id="return">return</h5>
<p>Returns the metadata of the entity you look for or null</p>

        
          <div class='highlight'><pre>WitDriver.getEntityMeta = entity =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(entity.metadata);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
};
<span class="hljs-keyword">export</span> { WitDriver };</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
